# ENLA Data Analysis Platform

This repository provides an R/Shiny application and supporting scripts to analyze ENLA data. It integrates EM performance with questionnaire data, supports correlation-network exploration by questionnaire, renders question dictionaries, and includes an EDA module and a causal structure learning prototype.

## Project Structure

```
education/
├── data/
│   ├── xlsx/                      # Source Excel files (questionnaires and EM)
│   └── enla_processed_data.rds    # Output of the data pipeline (input to the app)
├── app/
│   └── app.R                      # Main Shiny application
├── scripts/
│   ├── data_integration.R         # Pipeline: loading, standardization, integration
│   ├── data_validation.R          # Consistency checks
│   └── eda.R                      # Standalone EDA (generates PNG figures)
├── outputs/
│   └── eda/
│       └── figures/               # Figures generated by scripts/eda.R
├── INSTRUCCIONES_MATCHING.txt
└── README.md
```

## Requirements

- R >= 4.0
- R packages: `shiny`, `readxl`, `readr`, `dplyr`, `purrr`, `stringr`, `igraph`, `RColorBrewer`, `tibble`, `scales`, `DT`, `ggplot2`, `pcalg`.

## Data Pipeline

Run the pipeline to produce `data/enla_processed_data.rds` containing EM and questionnaire data prepared for the app. The pipeline standardizes column names, keeps all EM columns (for EDA), repairs duplicate column names, loads questionnaire matrices, detects item codes (pXX, pXX_YY), and aggregates EM where applicable.

```bash
R -e "source('scripts/data_integration.R'); run_enla_data_pipeline()"
```

## Launch the App

```bash
R -e "shiny::runApp('app', launch.browser = TRUE)"
```

## Standalone EDA (optional)

```bash
# All comparative plots (gender, language, area) in violin and scatter
Rscript scripts/eda.R

# Only language as scatter
Rscript scripts/eda.R --group=language --plot=scatter
```

Figures are written to `outputs/eda/figures/`.

## Application Modules

### EDA
- Plots: comparative distributions and M–L scatter-density for:
  - Gender (boy/girl mapping from typical labels)
  - Language (spanish/other)
  - Area (rural/urban)
- Summary: table with row/column counts for EM and each questionnaire (and item counts).

### Network & Questionnaire Analysis
- Questionnaire tabs: one per questionnaire.
- Network sub-tab:
  - Parameters: correlation threshold |r|, level (item vs pXX aggregates), aggregation method (mean, median, z-mean, PCA-1), optional inclusion of L/M performance nodes from EM.
  - Graph visualization (igraph).
  - “Links to L/M” table: edges incident to L/M with r and |r|, filtered by the threshold and current level.
- Questions sub-tab:
  - DataTable with Item (pXX), Question stem, Sub-items, and Options.
  - Dictionary is parsed from the questionnaire Excel (sheet named “Diccionario” or the second sheet).

### Advanced Modeling
- Estimation: variable selection per questionnaire, optional target L/M included from EM, and PC algorithm (pcalg) to learn a DAG. Status text reports run time and dimensions used.
- Prediction: placeholder for future predictive modeling.

## Technical Notes

- `scripts/data_integration.R`:
  - EM is read (BD sheet), column names standardized, duplicates repaired via `make.unique`, and all columns retained for EDA. `medida500_L` and `medida500_M` are coerced to numeric.
  - Each questionnaire is standardized; numeric `data` and original `full_data` are stored, along with detected item indices (pXX, pXX_YY). Aggregations for EM are computed where needed.
  - Output is serialized to `data/enla_processed_data.rds`.

- `app/app.R`:
  - Loads the RDS and builds questionnaire tabs (certain utility datasets are excluded by name).
  - Network: computes correlations, constructs an `igraph` graph, optionally appends L/M nodes from EM, and lists L/M incident edges.
  - Questions: reads dictionary content from the original questionnaire Excel to display stems, sub-items, and options.
  - Advanced Modeling: PC estimation from a user-selected subset of items plus L or M.

- `scripts/eda.R`:
  - Detects grouping columns (gender, language, area) and maps to compact labels (boy/girl; spanish/other; rural/urban).
  - Generates violin and scatter+contour plots for `medida500_M` vs `medida500_L`.

## Usage Notes

- If an EDA panel reports insufficient data, the grouping column may be absent or fully missing in your EM data.

- If L/M nodes do not appear in the network, enable “Include L/M nodes” and verify `medida500_L`/`medida500_M` exist in the selected questionnaire’s `full_data`.

- If the dictionary cannot be located, ensure a questionnaire Excel is available under `data/xlsx/` with a dictionary sheet (named “Diccionario” or in position 2).

## Reproducibility

- Keep source Excel files under `data/xlsx/`.
- Re-run the data pipeline when inputs change to refresh `data/enla_processed_data.rds`.
- Launch the app to interactively explore networks, questions, EDA, and the PC estimation prototype.
